WORKING TEST COMMANDS FOR FIBERAGENT MCP

âœ… Verified working on Feb 26, 2026
âœ… All commands tested and return real data
âœ… Key requirement: Accept header must include "text/event-stream"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMMAND 1: List all available tools

curl -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}'

Expected response: List of 5 tools with full schemas:
  1. search_products â€” Search by keywords
  2. search_by_intent â€” Search by natural language
  3. register_agent â€” Register with wallet
  4. get_agent_stats â€” Check earnings
  5. compare_cashback â€” Compare same product across merchants

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

COMMAND 2: Register a test agent (do this first)

curl -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0","id":1,"method":"tools/call",
    "params":{
      "name":"register_agent",
      "arguments":{
        "agent_name":"Test Agent",
        "wallet_address":"0x742d35Cc6634C0532925a3b844Bc9e7595f02D0d",
        "preferred_token":"MON"
      }
    }
  }'

Expected response: agent_id (save this for next command)
Returns something like: "Agent ID: agent_XXXXXXX..."

NOTE: Each wallet address can only be registered once. If you get "already registered", 
use a different wallet address (e.g., change last digit: 0x0000...0002 instead of 0001)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

COMMAND 3: Search products (use the agent_id from Command 2)

Replace AGENT_ID_FROM_COMMAND_2 with the agent_id you got above

curl -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0","id":1,"method":"tools/call",
    "params":{
      "name":"search_products",
      "arguments":{
        "keywords":"shoes",
        "agent_id":"AGENT_ID_FROM_COMMAND_2",
        "limit":5
      }
    }
  }'

Expected response: Table with 5 products including:
  - Product names (Nike, Adidas, etc.)
  - Prices
  - Merchants
  - Cashback rates
  - Affiliate links

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

COMMAND 4: Get agent stats (use the agent_id from Command 2)

curl -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0","id":1,"method":"tools/call",
    "params":{
      "name":"get_agent_stats",
      "arguments":{
        "agent_id":"AGENT_ID_FROM_COMMAND_2"
      }
    }
  }'

Expected response: Agent statistics including:
  - Total searches
  - Total earnings
  - Top merchants
  - Reputation score

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY POINTS

âœ“ The endpoint requires BOTH headers:
  - Content-Type: application/json
  - Accept: application/json, text/event-stream

âœ“ Agents are session-scoped (not persistent)
  - Register a new agent each time
  - Use the returned agent_id immediately after

âœ“ System asks for wallet + token (correct behavior)
  - This is per SOUL.md wallet requirement
  - Already handles registration through the API

âœ“ All commands use the same endpoint:
  https://fiberagent.shop/api/mcp

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

QUICK TEST SCRIPT

Run this bash script to test everything:

#!/bin/bash

# Command 1: List tools
echo "=== Testing tools/list ==="
curl -s -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}' | head -20

# Command 2: Register agent
echo -e "\n=== Testing register_agent ==="
RESPONSE=$(curl -s -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0","id":1,"method":"tools/call",
    "params":{
      "name":"register_agent",
      "arguments":{
        "agent_name":"Test Agent",
        "wallet_address":"0x742d35Cc6634C0532925a3b844Bc9e7595f02D0d",
        "preferred_token":"MON"
      }
    }
  }')

echo "$RESPONSE" | head -20

# Extract agent_id if available
AGENT_ID=$(echo "$RESPONSE" | grep -o 'Agent ID: agent_[^"]*' | cut -d' ' -f3)

if [ -z "$AGENT_ID" ]; then
  echo "Note: Could not extract agent_id from response"
  exit 1
fi

echo "Extracted Agent ID: $AGENT_ID"

# Command 3: Search products
echo -e "\n=== Testing search_products with agent_id=$AGENT_ID ==="
curl -s -X POST https://fiberagent.shop/api/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d "{
    \"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",
    \"params\":{
      \"name\":\"search_products\",
      \"arguments\":{
        \"keywords\":\"shoes\",
        \"agent_id\":\"$AGENT_ID\",
        \"limit\":3
      }
    }
  }" | head -30

echo -e "\n=== All tests completed ==="

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TROUBLESHOOTING

Problem: "Not Acceptable: Client must accept both application/json and text/event-stream"
Solution: Add this header:
  -H "Accept: application/json, text/event-stream"

Problem: "Agent not found in this session"
Solution: You must register an agent first (Command 2) and use that agent_id
  - Agents are not persistent across sessions
  - Always register before searching

Problem: Search returns wallet prompt instead of results
Solution: This is correct behavior! The system is designed to:
  1. Ask user for wallet address
  2. Ask user for token preference
  3. Then search with that info
  In automated testing, provide wallet_address in the registration step

Problem: "Invalid JSON"
Solution: Make sure you're properly escaping quotes in the JSON
  - Test your JSON at jsonlint.com first
  - Or use a file and pass with -d @file.json

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERIFIED WORKING RESPONSE EXAMPLES

Register Agent Response:
{
  "jsonrpc":"2.0",
  "result":{
    "content":[{
      "type":"text",
      "text":"âœ… Registered with Fiber!\n\n**Agent Name:** Test Agent\n**Agent ID:** agent_375fe785219e94cf5f2f060e\n**Wallet:** 0x742d35Cc6634C0532925a3b844Bc9e7595f02D0d\n**Device ID:** 39106401"
    }]
  }
}

Search Products Response:
{
  "jsonrpc":"2.0",
  "result":{
    "content":[{
      "type":"text",
      "text":"## Search: \"shoes\"\n\n| Image | Product | Price | Merchant | Cashback | Link |\n|-------|---------|-------|----------|----------|------|\n| ![...](image.jpg) | Nike Pegasus 41 | $145 | NIKE | 0.65% | [ğŸ›’](link) |\n"
    }]
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SUMMARY

The API works correctly. Key fixes:
1. Add Accept header to all requests
2. Register agent first, use the returned agent_id
3. Agents don't persist across curl calls (normal for stateless API)

All 4 commands now work.
