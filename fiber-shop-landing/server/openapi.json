{
  "openapi": "3.0.0",
  "info": {
    "title": "Fiber Agent API",
    "description": "AI shopping agent enabling autonomous agents to discover and shop across 50,000+ merchants with on-chain rewards",
    "version": "1.0.0",
    "contact": {
      "name": "Fiber Agent Support",
      "url": "https://fiberagent.shop",
      "email": "support@fiber.shop"
    },
    "x-api-note": "This API is designed for AI agents to integrate directly. The /agent/* endpoints are your primary interface. Use /agent/task for natural language requests or /agent/search for structured queries."
  },
  "servers": [
    {
      "url": "https://fiberagent.shop/api",
      "description": "Production API (use /agent/* endpoints)"
    },
    {
      "url": "http://localhost:5000/api",
      "description": "Development API"
    }
  ],
  "x-architecture": {
    "overview": "FiberAgent has two integration patterns:",
    "external-agents": {
      "description": "For AI agents integrating with FiberAgent",
      "endpoints": "/api/agent/* (direct REST endpoints)",
      "examples": {
        "register": "POST https://fiberagent.shop/api/agent/register",
        "search": "GET https://fiberagent.shop/api/agent/search?keywords=shoes&agent_id=my_bot",
        "stats": "GET https://fiberagent.shop/api/agent/{agent_id}/stats"
      },
      "note": "Call these endpoints directly from your agent code"
    },
    "web-frontend": {
      "description": "Internal frontend proxy (not for external agents)",
      "note": "The frontend uses an internal CORS proxy. External agents should use /agent/* endpoints directly."
    }
  },
  "paths": {
    "/agent/register": {
      "post": {
        "summary": "Register a new AI agent",
        "tags": ["Agent Management"],
        "description": "Register an AI agent with wallet address and preferences. Returns agent_id for future API calls. This is a direct FiberAgent endpoint - external agents call this directly, NOT through /api/fiber-proxy.",
        "x-audience": "external-agents",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["agent_id", "wallet_address"],
                "properties": {
                  "agent_id": {
                    "type": "string",
                    "description": "Unique identifier for the agent",
                    "example": "agent_ai_001"
                  },
                  "agent_name": {
                    "type": "string",
                    "description": "Human-readable name for the agent",
                    "example": "My Shopping Bot"
                  },
                  "wallet_address": {
                    "type": "string",
                    "description": "EVM wallet address (Monad) for receiving rewards",
                    "example": "0x790b405d466f7fddcee4be90d504eb56e3fedcae"
                  },
                  "crypto_preference": {
                    "type": "string",
                    "enum": ["MON", "BONK", "USDC"],
                    "description": "Preferred reward token",
                    "example": "MON"
                  }
                }
              }
            }
          }
        },
        "x-code-samples": [
          {
            "lang": "curl",
            "source": "curl -X POST https://fiberagent.shop/api/agent/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"agent_id\": \"claude-shopping-001\",\n    \"agent_name\": \"Claude Shopping Helper\",\n    \"wallet_address\": \"0x790b405d466f7fddcee4be90d504eb56e3fedcae\",\n    \"crypto_preference\": \"MON\"\n  }'"
          },
          {
            "lang": "python",
            "source": "import requests\n\nresponse = requests.post(\n    'https://fiberagent.shop/api/agent/register',\n    json={\n        'agent_id': 'claude-shopping-001',\n        'agent_name': 'Claude Shopping Helper',\n        'wallet_address': '0x790b405d466f7fddcee4be90d504eb56e3fedcae',\n        'crypto_preference': 'MON'\n    }\n)\n\nprint(response.json())"
          },
          {
            "lang": "javascript",
            "source": "const response = await fetch('https://fiberagent.shop/api/agent/register', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    agent_id: 'claude-shopping-001',\n    agent_name: 'Claude Shopping Helper',\n    wallet_address: '0x790b405d466f7fddcee4be90d504eb56e3fedcae',\n    crypto_preference: 'MON'\n  })\n});\n\nconst data = await response.json();\nconsole.log(data);"
          }
        ],
        "responses": {
          "200": {
            "description": "Agent registered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "agent": {
                      "type": "object",
                      "properties": {
                        "agent_id": { "type": "string" },
                        "agent_name": { "type": "string" },
                        "wallet_address": { "type": "string" },
                        "crypto_preference": { "type": "string" },
                        "registered_at": { "type": "string", "format": "date-time" }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing required fields"
          }
        }
      }
    },
    "/agent/search": {
      "get": {
        "summary": "Search products (GET)",
        "tags": ["Product Search"],
        "description": "Search for products by keywords. This is a direct FiberAgent endpoint - external agents call this directly. Required: agent_id (for tracking), keywords (search query).",
        "x-audience": "external-agents",
        "parameters": [
          {
            "name": "keywords",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Product keywords to search for",
            "example": "nike shoes"
          },
          {
            "name": "agent_id",
            "in": "query",
            "required": false,
            "schema": { "type": "string" },
            "description": "Agent ID for tracking stats. If omitted, tracked as 'anonymous'"
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 10 },
            "description": "Number of results to return (max 50)"
          }
        ],
        "x-code-samples": [
          {
            "lang": "curl",
            "source": "curl \"https://fiberagent.shop/api/agent/search?keywords=nike%20shoes&agent_id=agent-001&size=5\""
          },
          {
            "lang": "python",
            "source": "import requests\n\nresponse = requests.get(\n    'https://fiberagent.shop/api/agent/search',\n    params={\n        'keywords': 'nike shoes',\n        'agent_id': 'agent-001',\n        'size': 5\n    }\n)\n\nfor product in response.json()['results']:\n    print(f\"{product['title']} - ${product['price']}\")\n    print(f\"  Cashback: {product['cashback']['rate']}\")"
          },
          {
            "lang": "javascript",
            "source": "const params = new URLSearchParams({\n  keywords: 'nike shoes',\n  agent_id: 'agent-001',\n  size: 5\n});\n\nconst response = await fetch(\n  `https://fiberagent.shop/api/agent/search?${params}`\n);\n\nconst data = await response.json();\ndata.results.forEach(product => {\n  console.log(`${product.title} - $${product.price}`);\n  console.log(`  Cashback: ${product.cashback.rate}`);\n});"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results with product data and cashback rates",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "query": { "type": "string" },
                    "agent_id": { "type": "string" },
                    "total_results": { "type": "integer" },
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "productId": { "type": "string" },
                          "title": { "type": "string" },
                          "brand": { "type": "string" },
                          "price": { "type": "number" },
                          "image": { "type": "string", "format": "uri" },
                          "affiliate_link": { "type": "string", "format": "uri" },
                          "shop": {
                            "type": "object",
                            "properties": {
                              "name": { "type": "string" },
                              "domain": { "type": "string" }
                            }
                          },
                          "cashback": {
                            "type": "object",
                            "properties": {
                              "rate": { "type": "string", "example": "5%" },
                              "amount": { "type": "number", "example": 5.0 }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing keywords parameter"
          }
        }
      },
      "post": {
        "summary": "Search products (POST)",
        "tags": ["Product Search"],
        "description": "Search for products by keywords (POST variant). Direct FiberAgent endpoint. Requires agent_id and query.",
        "x-audience": "external-agents",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["query", "agent_id"],
                "properties": {
                  "query": { "type": "string", "example": "nike shoes" },
                  "agent_id": { "type": "string" },
                  "size": { "type": "integer", "default": 10 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results"
          }
        }
      }
    },
    "/agent/task": {
      "post": {
        "summary": "Natural language task (agent-to-agent)",
        "tags": ["Agent-to-Agent"],
        "description": "Send a natural language intent and get ranked product results. FiberAgent parses the intent, extracts keywords, applies price constraints and preferences, and returns the best matches sorted by relevance and cashback. This is the recommended endpoint for agent-to-agent integration.",
        "x-audience": "external-agents",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["agent_id", "intent"],
                "properties": {
                  "agent_id": { "type": "string", "example": "oracle_agent" },
                  "intent": { "type": "string", "example": "Find creatine monohydrate under $30, highest cashback" },
                  "context": {
                    "type": "object",
                    "properties": {
                      "preferences": {
                        "type": "array",
                        "items": { "type": "string" },
                        "example": ["bulk", "unflavored"]
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Task results with parsed intent and ranked products",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "task": {
                      "type": "object",
                      "properties": {
                        "intent": { "type": "string" },
                        "parsed_keywords": { "type": "string" },
                        "price_constraint": { "type": "object" },
                        "sort_by_cashback": { "type": "boolean" }
                      }
                    },
                    "total_results": { "type": "integer" },
                    "results": { "type": "array" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/agent/{agent_id}": {
      "get": {
        "summary": "Lookup agent",
        "tags": ["Agent Management"],
        "description": "Get details of a registered agent by ID.",
        "x-audience": "external-agents",
        "parameters": [
          {
            "name": "agent_id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Agent details" },
          "404": { "description": "Agent not found" }
        }
      }
    },
    "/agent/{agent_id}/stats": {
      "get": {
        "summary": "Get agent statistics",
        "tags": ["Agent Management"],
        "description": "Retrieve performance metrics for a specific agent. Direct FiberAgent endpoint.",
        "x-audience": "external-agents",
        "parameters": [
          {
            "name": "agent_id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "example": "agent_ai_001"
          }
        ],
        "x-code-samples": [
          {
            "lang": "curl",
            "source": "curl \"https://fiberagent.shop/api/agent/agent-001/stats\" \\\n  -H \"Authorization: Bearer sk_live_...\""
          },
          {
            "lang": "python",
            "source": "import requests\n\nheaders = {\n    'Authorization': 'Bearer sk_live_...'\n}\n\nresponse = requests.get(\n    'https://fiberagent.shop/api/agent/agent-001/stats',\n    headers=headers\n)\n\nstats = response.json()\nprint(f\"Total searches: {stats['total_searches']}\")\nprint(f\"Total earnings: ${stats['total_earnings']}\")\nprint(f\"API calls: {stats['api_calls_made']}\")"
          },
          {
            "lang": "javascript",
            "source": "const response = await fetch(\n  'https://fiberagent.shop/api/agent/agent-001/stats',\n  {\n    headers: {\n      'Authorization': 'Bearer sk_live_...'\n    }\n  }\n);\n\nconst stats = await response.json();\nconsole.log(`Total searches: ${stats.total_searches}`);\nconsole.log(`Total earnings: $${stats.total_earnings}`);\nconsole.log(`API calls: ${stats.api_calls_made}`);"
          }
        ],
        "responses": {
          "200": {
            "description": "Agent statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "agent_id": { "type": "string" },
                    "total_searches": { "type": "integer" },
                    "total_earnings": { "type": "number" },
                    "total_purchases_tracked": { "type": "integer" },
                    "api_calls_made": { "type": "integer" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Agent not found"
          }
        }
      }
    },
    "/agent/earnings/{agent_id}": {
      "get": {
        "summary": "Get agent earnings",
        "tags": ["Rewards"],
        "description": "Retrieve total earnings and breakdown by token type. Direct FiberAgent endpoint.",
        "x-audience": "external-agents",
        "parameters": [
          {
            "name": "agent_id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Earnings summary"
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health check",
        "tags": ["System"],
        "description": "Check API status and get basic metrics",
        "responses": {
          "200": {
            "description": "Service is healthy"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Agent": {
        "type": "object",
        "properties": {
          "agent_id": { "type": "string" },
          "agent_name": { "type": "string" },
          "wallet_address": { "type": "string" },
          "crypto_preference": { "type": "string" },
          "registered_at": { "type": "string", "format": "date-time" },
          "total_earnings": { "type": "number" },
          "api_calls_made": { "type": "integer" }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "productId": { "type": "string" },
          "title": { "type": "string" },
          "brand": { "type": "string" },
          "price": { "type": "number" },
          "image": { "type": "string", "format": "uri" },
          "affiliate_link": { "type": "string", "format": "uri" },
          "shop": { "type": "object" },
          "cashback": { "type": "object" }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Agent Management",
      "description": "Register agents, manage profiles"
    },
    {
      "name": "Product Search",
      "description": "Search and discover products"
    },
    {
      "name": "Rewards",
      "description": "Track earnings and rewards"
    },
    {
      "name": "System",
      "description": "Health and status endpoints"
    }
  ]
}
